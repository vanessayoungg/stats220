---
title: My dynamic report
output: html_fragment
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, error=FALSE)
library(tidyverse)
```

```{css}
/* custom styling */
body {
  font-family: Arial, sans-serif;
  font-size: 16px;
  background-color: #f5f5dc; /* beige background */
  padding: 2rem;
  margin: 0;
}

h2 {
  color: #808080;
}

/* Chart container with pastel yellow border and spacing */
.chart-container {
  border: 2px solid #fff8b3; /* pastel yellow */
  border-radius: 8px;
  padding: 16px;
  margin: 40px 0; /* Adds top and bottom spacing */
  background-color: #ffffff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}


```

# Load the tidyverse package
library(tidyverse)

# Import the data
logged_data <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRQtlW5t7zNifon10TZmabGOnYOtfesceP5QSQRCqFu-Zoxlxbu4w2fVFGF__DPp9ocXRx4BelWQ9JL/pub?output=csv")

# Rename columns (based on actual order from your form)
latest_data <- logged_data %>%
  rename(
    timestamp = 1,
    num_people = 4,
    cleanliness = 3,
    soap_available = 2
  )

# Remove rows with missing values
latest_data <- latest_data %>%
  filter(!is.na(num_people), !is.na(cleanliness), !is.na(soap_available))

# Summary values
num_obs <- nrow(latest_data)
mean_people <- round(mean(latest_data$num_people), 1)
min_people <- min(latest_data$num_people)
max_people <- max(latest_data$num_people)

# Most common cleanliness level
cleanliness_table <- table(latest_data$cleanliness)
most_common_cleanliness <- names(cleanliness_table)[which.max(cleanliness_table)]

# Soap availability summary
soap_table <- table(latest_data$soap_available)
yes_soap <- soap_table["Yes"]
no_soap <- soap_table["No"]
total_soap <- yes_soap + no_soap
percent_yes <- round((yes_soap / total_soap) * 100, 1)
percent_no <- round((no_soap / total_soap) * 100, 1)


# Bar chart: Cleanliness level
ggplot(latest_data) +
  geom_bar(aes(x = cleanliness), fill = "#A7C7E7") +
  labs(
    title = "Cleanliness of Restrooms",
    x = "Cleanliness Level",
    y = "Count",
    caption = "Source: STATS 220 Observational Log"
  ) +
  theme_minimal()

# Bar chart: Soap and paper towel availability
ggplot(latest_data) +
  geom_bar(aes(x = soap_available), fill = "#FFB6C1") +
  labs(
    title = "Soap and Paper Towel Availability",
    x = "Soap Available?",
    y = "Count",
    caption = "Source: STATS 220 Observational Log"
  ) +
  theme_minimal()



# Dynamic comments
paste0("There were ", num_obs, " complete observations recorded in this dataset.")
paste0("On average, ", mean_people, " people used the restroom during each observation.")
paste0("The most commonly reported cleanliness level was ", most_common_cleanliness, ".")
paste0("Soap and paper towels were available in ", yes_soap, " out of ", total_soap,
       " observed restrooms (", percent_yes, "%). In contrast, ", no_soap,
       " observations (", percent_no, "%) reported no supplies present.")



```
